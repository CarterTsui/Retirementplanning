<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Retirement Planner (Monthly)</title>
  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 5px;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    #results {
      margin-top: 30px;
    }
    #chartContainer {
      margin-top: 30px;
    }
    canvas {
      background: #fff;
      border: 1px solid #ccc;
    }
    @media (max-width: 600px) {
      .container {
        margin: 10px;
      }
    }
  </style>
</head>
<body>
  <h1>Retirement Planner (Monthly Compounding)</h1>
  <div class="container">
    <label for="currentAge">Current Age</label>
    <input type="number" id="currentAge" placeholder="e.g. 30" min="0"/>

    <label for="retirementAge">Retirement Age</label>
    <input type="number" id="retirementAge" placeholder="e.g. 65" min="0"/>

    <label for="currentSavings">Current Savings (USD)</label>
    <input type="number" id="currentSavings" placeholder="e.g. 20000" min="0"/>

    <label for="currentInvestments">Current Investments (USD)</label>
    <input type="number" id="currentInvestments" placeholder="e.g. 50000" min="0"/>

    <label for="annualReturnSavings">Annual Return (Savings) %</label>
    <input type="number" id="annualReturnSavings" placeholder="e.g. 2" step="0.01"/>

    <label for="annualReturnInvestments">Annual Return (Investments) %</label>
    <input type="number" id="annualReturnInvestments" placeholder="e.g. 7" step="0.01"/>

    <label for="monthlySavingsContribution">Monthly Savings Contribution (USD)</label>
    <input type="number" id="monthlySavingsContribution" placeholder="e.g. 300" min="0"/>

    <label for="monthlyInvestmentContribution">Monthly Investment Contribution (USD)</label>
    <input type="number" id="monthlyInvestmentContribution" placeholder="e.g. 500" min="0"/>

    <label for="inflationRate">Annual Inflation Rate (%)</label>
    <input type="number" id="inflationRate" placeholder="e.g. 2" step="0.01"/>

    <label for="desiredMonthlyWithdrawal">Desired Monthly Withdrawal After Retirement (USD)</label>
    <input type="number" id="desiredMonthlyWithdrawal" placeholder="e.g. 3000" min="0"/>

    <button class="btn" id="calculateBtn">Calculate</button>

    <div id="results"></div>

    <div id="chartContainer">
      <canvas id="balanceChart" width="400" height="200"></canvas>
    </div>
  </div>

  <script>
    const calculateBtn = document.getElementById('calculateBtn');
    const resultsDiv = document.getElementById('results');

    calculateBtn.addEventListener('click', () => {
      // 1) Gather inputs
      const currentAge = parseFloat(document.getElementById('currentAge').value);
      const retirementAge = parseFloat(document.getElementById('retirementAge').value);
      const currentSavings = parseFloat(document.getElementById('currentSavings').value);
      const currentInvestments = parseFloat(document.getElementById('currentInvestments').value);
      const annualReturnSavings = parseFloat(document.getElementById('annualReturnSavings').value) / 100;
      const annualReturnInvestments = parseFloat(document.getElementById('annualReturnInvestments').value) / 100;
      const monthlySavingsContribution = parseFloat(document.getElementById('monthlySavingsContribution').value);
      const monthlyInvestmentContribution = parseFloat(document.getElementById('monthlyInvestmentContribution').value);
      const annualInflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
      const desiredMonthlyWithdrawal = parseFloat(document.getElementById('desiredMonthlyWithdrawal').value);

      // 2) Basic validation
      if (
        isNaN(currentAge) || isNaN(retirementAge) ||
        isNaN(currentSavings) || isNaN(currentInvestments) ||
        isNaN(annualReturnSavings) || isNaN(annualReturnInvestments) ||
        isNaN(monthlySavingsContribution) || isNaN(monthlyInvestmentContribution) ||
        isNaN(annualInflationRate) || isNaN(desiredMonthlyWithdrawal)
      ) {
        alert("Please fill all fields with valid numbers.");
        return;
      }
      if (retirementAge <= currentAge) {
        alert("Retirement age must be greater than current age.");
        return;
      }

      // 3) Monthly rates
      const monthlyReturnSavings = Math.pow(1 + annualReturnSavings, 1/12) - 1;
      const monthlyReturnInvestments = Math.pow(1 + annualReturnInvestments, 1/12) - 1;
      const monthlyInflation = Math.pow(1 + annualInflationRate, 1/12) - 1;

      // 4) Time ranges (in months)
      const startMonth = Math.floor(currentAge * 12);
      const retireMonth = Math.floor(retirementAge * 12);
      const endMonth = 100 * 12;  // project until age 100 (in months)

      // 5) Initialize balances
      let savingsBalance = currentSavings;
      let investmentBalance = currentInvestments;

      // 6) For tracking data
      let chartLabels = [];       // each label = age in years
      let chartData = [];         // each data = total balance

      // We track monthly, but we'll only store once per year in the chart to reduce data density
      const storeDataIfYearPassed = (monthCount) => {
        // If the monthCount is exactly a multiple of 12, we store a data point
        if (monthCount % 12 === 0) {
          const currentAgeInYears = monthCount / 12;
          chartLabels.push(currentAgeInYears.toFixed(0));
          chartData.push(savingsBalance + investmentBalance);
        }
      };

      // 7) Accumulation Phase: from currentAge in months to retirementAge in months
      for (let m = startMonth; m < retireMonth; m++) {
        // Add monthly contributions
        savingsBalance += monthlySavingsContribution;
        investmentBalance += monthlyInvestmentContribution;

        // Apply monthly returns
        savingsBalance *= (1 + monthlyReturnSavings);
        investmentBalance *= (1 + monthlyReturnInvestments);

        storeDataIfYearPassed(m);
      }

      // 8) Retirement / Withdrawal Phase
      // Initialize monthly withdrawal to user-specified value
      let currentMonthlyWithdrawal = desiredMonthlyWithdrawal;

      for (let m = retireMonth; m <= endMonth; m++) {
        // Withdraw from total balance
        let totalBalance = savingsBalance + investmentBalance;
        if (totalBalance <= 0) {
          // If it's already 0 or negative, break out
          savingsBalance = 0;
          investmentBalance = 0;
          storeDataIfYearPassed(m);
          continue;
        }

        // If totalBalance < currentMonthlyWithdrawal, set it to zero
        if (totalBalance < currentMonthlyWithdrawal) {
          savingsBalance = 0;
          investmentBalance = 0;
        } else {
          // We can withdraw
          // (For simplicity, withdraw from savings first, then from investments)
          if (savingsBalance >= currentMonthlyWithdrawal) {
            savingsBalance -= currentMonthlyWithdrawal;
          } else {
            const remainder = currentMonthlyWithdrawal - savingsBalance;
            savingsBalance = 0;
            investmentBalance -= remainder;
          }
        }

        // Apply monthly returns to what's left
        savingsBalance *= (1 + monthlyReturnSavings);
        investmentBalance *= (1 + monthlyReturnInvestments);

        // Increase the monthly withdrawal by monthly inflation
        currentMonthlyWithdrawal *= (1 + monthlyInflation);

        storeDataIfYearPassed(m);
      }

      // 9) Final Balance
      let finalBalance = savingsBalance + investmentBalance;

      // 10) Display results
      resultsDiv.innerHTML = `
        <h2>Results</h2>
        <p>Final balance at age 100: <strong>$${finalBalance.toFixed(2)}</strong></p>
      `;

      // 11) Plot chart
      createChart(chartLabels, chartData);
    });

    let chartInstance = null;
    function createChart(labels, data) {
      const ctx = document.getElementById('balanceChart').getContext('2d');
      if (chartInstance) {
        chartInstance.destroy();
      }
      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Balance',
            data: data,
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Balance (USD)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Age (Years)'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
